University: [ITMO University](https://itmo.ru/ru/)

Faculty: [FICT](https://fict.itmo.ru)

Course: [Network programming](https://github.com/itmo-ict-faculty/network-programming)

Year: 2022

Group: K34202

Author: Trieu Minh Tam

Lab: Lab1

Date of create: 06.10.2022

Date of finished: 


Тема работы: Установка CHR и Ansible, настройка VPN

Цель работы: развертывание виртуальной машины с установленной системой контроля конфигураций Ansible и установка CHR в VirtualBox


Ход работы:
1. Создаём виртуальную машину в Яндекс.Облаке на операционной системе Ubuntu.

2. Подключаемся к ней по ssh, устанавливаем ansible.
![image](https://user-images.githubusercontent.com/87965299/194329321-c4d229b0-4aff-4c40-992f-e1be83411380.png)

3. В VirtualBox устанавливаем MikroTik 7 версии, это будет важно для дальнейшей работы. Здесь имеет смысл обратить внимание на то, что после загрузки в настройках VirtualBox необходимо отключить загрузочный диск вручную, тогда как на установке более привычных операционных систем это происходит автоматически.

4. После этого устанавливаем Wireguard на удалённую машину, прописываем в нём в файл условий интерфейса. Создаём пару ключей.

5. После этого начинаем работу с MikroTik. Было обнаружено, что большая часть инструкций по его использованию объясняют работу при помощи графического интерфейса WinBox. По этой причине было решено установить графический интерфейс.

6. С помощью Winbox получилось подключиться к виртуальной машине MikroTik.
![image](https://user-images.githubusercontent.com/87965299/194329653-581d378e-e6eb-41ea-92e2-c30d24678d23.png)

7. Поскольку в качестве VPN был выбран WireGuard, и установлен MikroTik последней версии, заходим в настройку Wireguard и создаём там новый интерфейс.
8. Заполняем конфиг файл wg0.conf.
![image](https://user-images.githubusercontent.com/87965299/195593722-2105b20a-3ae5-47fe-97cd-5b4ff7946c18.png)

9. Заполняем строки: MTU оставляем как указано, ListenPort узнаём командой вывода файла /etc/wireguard/wg0.conf на сервере, ключи будут сгененрированы автоматически.
![image](https://user-images.githubusercontent.com/87965299/195594525-e7f6a2ad-fb82-40b9-b995-d75a59754e48.png)

10. Переходим во вторую вкладку, там создаём Peer - указываем только что созданный интерфейс, указываем публичный ключ сервера, его публичный IP, указанный ранее порт и сеть адресов, по которым будет идти подключение.
![image](https://user-images.githubusercontent.com/87965299/194329996-06ae7b5e-d0b4-47ad-bffd-d4d170be1eca.png)

11. В настройке IP - Addresses указываем выбранную сеть и созданный интерфейс.
![image](https://user-images.githubusercontent.com/87965299/194330079-266e0da3-82d1-420c-b1ce-3c80690294a9.png)

12. В настройке IP - Firewall создаём NAT Rule masquerade, Masquerade NAT позволяет преобразовывать несколько IP-адресов в другой одиночный IP-адрес. Можно использовать маскарадный NAT, чтобы скрыть один или несколько IP-адресов во внутренней сети за IP-адресом, который нужно сделать общедоступным.
![image](https://user-images.githubusercontent.com/87965299/194330146-4f021507-eb4f-4f96-92ff-e0a7a6b3e37a.png)

13. Теперь для проверки работоспособности запускаем ping к виртуальной машине по заданному IP адресу. Пинг идёт - следовательно, все настройки выполнены корректно.
![image](https://user-images.githubusercontent.com/87965299/195593361-957c5415-1a67-4e9e-b109-10ad596f8cdc.png)

14. В результате получаем связь по следующей схеме.
![image](https://user-images.githubusercontent.com/87965299/194330244-9b3d3869-7d0a-4e53-970e-fcb69634be3f.png)

Выводы: При помощи WireGuard возможно настроить VPN туннель между виртуальной машиной с операционной системой RouterOS и удалённой виртуальной машиной. Для работы с RouterOS достаточно удобно использовать графический интерфейс.
